# Migration `20200721173148`

This migration has been generated by rahuldamodar94 at 7/21/2020, 5:31:48 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."bids" (
"active" boolean   DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"orders_id" integer  NOT NULL ,"price" text  NOT NULL ,"signature" text  NOT NULL ,"status" integer   DEFAULT 0,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"users_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."categories" (
"active" boolean   DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text   ,"id" SERIAL,"img_url" text   ,"name" text  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"url" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."categoriesaddresses" (
"active" boolean   DEFAULT true,"address" text  NOT NULL ,"categories_id" integer  NOT NULL ,"chain_id" text  NOT NULL ,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."erc20tokens" (
"active" boolean   DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"decimal" integer  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"symbol" text  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."erc20tokensaddresses" (
"active" boolean   DEFAULT true,"address" text  NOT NULL ,"chain_id" text  NOT NULL ,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"token_id" integer  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."favourites" (
"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"order_id" integer  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"users_id" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."orders" (
"active" boolean   DEFAULT true,"categories_id" integer  NOT NULL ,"chain_id" text  NOT NULL ,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"erc20tokens_id" integer  NOT NULL ,"expiry_date" timestamp(3)   ,"id" SERIAL,"maker_address" integer   ,"min_price" text  NOT NULL ,"price" text  NOT NULL ,"signature" text   ,"status" integer   DEFAULT 0,"taker_address" integer   ,"taker_amount" text   ,"tokens_id" text  NOT NULL ,"txhash" text   ,"type" text  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"views" integer   DEFAULT 0,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."users" (
"active" boolean   DEFAULT true,"address" text  NOT NULL ,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."admins" (
"active" boolean   DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"password" text  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."notifications" (
"active" boolean  NOT NULL DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"message" text  NOT NULL ,"order_id" integer  NOT NULL ,"read" boolean  NOT NULL DEFAULT false,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"usersId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "categories.name" ON "public"."categories"("name")

CREATE UNIQUE INDEX "categoriesaddresses.address" ON "public"."categoriesaddresses"("address")

CREATE UNIQUE INDEX "erc20tokens.symbol" ON "public"."erc20tokens"("symbol")

CREATE UNIQUE INDEX "erc20tokensaddresses.address" ON "public"."erc20tokensaddresses"("address")

CREATE UNIQUE INDEX "users.address" ON "public"."users"("address")

CREATE UNIQUE INDEX "admins.username" ON "public"."admins"("username")

ALTER TABLE "public"."bids" ADD FOREIGN KEY ("orders_id")REFERENCES "public"."orders"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."bids" ADD FOREIGN KEY ("users_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."categoriesaddresses" ADD FOREIGN KEY ("categories_id")REFERENCES "public"."categories"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."erc20tokensaddresses" ADD FOREIGN KEY ("token_id")REFERENCES "public"."erc20tokens"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."favourites" ADD FOREIGN KEY ("order_id")REFERENCES "public"."orders"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."favourites" ADD FOREIGN KEY ("users_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("categories_id")REFERENCES "public"."categories"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("erc20tokens_id")REFERENCES "public"."erc20tokens"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("maker_address")REFERENCES "public"."users"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("taker_address")REFERENCES "public"."users"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."notifications" ADD FOREIGN KEY ("order_id")REFERENCES "public"."orders"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."notifications" ADD FOREIGN KEY ("usersId")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200717200518-notification-schema-change..20200721173148
--- datamodel.dml
+++ datamodel.dml
@@ -3,17 +3,18 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model bids {
   active    Boolean? @default(true)
   created   DateTime @default(now())
   id        Int      @default(autoincrement()) @id
   orders_id Int
   price     String
+  signature String
   status    Int?     @default(0)
   updated   DateTime @default(now())
   users_id  Int
   orders    orders   @relation(fields: [orders_id], references: [id])
@@ -84,9 +85,9 @@
   created        DateTime        @default(now())
   erc20tokens_id Int
   expiry_date    DateTime?
   id             Int             @default(autoincrement()) @id
-  maker_address  Int
+  maker_address  Int?
   min_price      String
   price          String
   signature      String?
   status         Int?            @default(0)
@@ -98,9 +99,9 @@
   updated        DateTime        @default(now())
   views          Int?            @default(0)
   categories     categories      @relation(fields: [categories_id], references: [id])
   erc20tokens    erc20tokens     @relation(fields: [erc20tokens_id], references: [id])
-  maker_users    users           @relation("maker_orders", fields: [maker_address], references: [id])
+  maker_users    users?          @relation("maker_orders", fields: [maker_address], references: [id])
   taker_users    users?          @relation("taker_orders", fields: [taker_address], references: [id])
   bids           bids[]
   notifications  notifications[]
   favourites     favourites[]
```


